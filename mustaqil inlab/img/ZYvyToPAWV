window.__jivoOnError=function(e){if(navigator.userAgent.search(/google/gi)===-1&&navigator.userAgent.search(/\+http:\/\/yandex\.com\/bots/gi)===-1)try{var t=window.location.protocol+"//err.jivosite.com/widget",o="POST",r={widget:"true",widget_version:window.jivo_version,level:2,url:window.location.href,user_agent:navigator.userAgent,lineNumber:e&&e.lineNumber,fileName:e&&e.fileName,column:e&&e.columnNumber,full_message:e&&e.stack,short_message:e&&e.message},n=new XMLHttpRequest;"withCredentials"in n?n.open(o,t,!0):"undefined"!=typeof XDomainRequest&&(n=new XDomainRequest,n.open(o,t)),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(r))}catch(e){}},function(){function e(e,t,o,r){function n(e){if(Q("Loading config from",e),T())return void oe.error("This widget is permanently removed");var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var e,r=R(o);try{e=JSON.parse(r)}catch(e){Q("Config is loaded as JSONP");var n=t.getElementsByTagName("script"),a=n[0],l=t.createElement("script");M(l),l.innerHTML=r,a.parentNode.insertBefore(l,a)}e&&(Q("Config is loaded",e),i(e))}else 0!==o.status&&B()},o.open("GET",e+"?rnd="+Math.random(),!0),o.send(null)}function i(e){if(e.isDeleted)return void k();if(Ee!==e.base_url)return Q("Wrong config host",Ee),Ee=e.base_url,void n(S());if(e.regions&&!Ne.isChatStarted){var t=O(e);if(t.widgetId!==Te)return Q("Wrong geo-widget widgetId",Te),w("geoWidgetInfo",t),Te=t.widgetId,void n(S())}w("configHost",Ee),l(e)}function a(e,t){return[e,t].reduce(function(e,t){return Object.keys(t).forEach(function(o){e[o]=t[o]}),e},{})}function l(t){if(w("log",!!t.logs),"[object Object]"===Object.prototype.toString.call(e.wix_context)&&"[object Object]"===Object.prototype.toString.call(e.jivo_wix)&&(t=a(t,e.jivo_wix)),e.jivo_config=re=t,x())throw Q("Host is blacklisted",e.location.host),new Error("Placing widget is forbidden on "+e.top.location.host);if(fe&&re.disable_mobile)return void Q("Mobile widget is disabled");s()}function s(){"complete"==t.readyState?d():Ne.bundleLoaded&&Ne.buildNumber==re.build_number?"interactive"==t.readyState?d():z(e,"DOMContentLoaded",d):(w("bundleLoaded",!1),z(e,"load",d))}function d(){Q("Widget initialization"),W(),u(),F()}function u(){Q("Iframe initialization"),ge.src="javascript:void(0)",ge.title="",ge.role="presentation",ge.allow="autoplay",ge.setAttribute("name","jivo_container"),ge.setAttribute("id","jivo_container"),ge.setAttribute("frameborder","no"),ve.className+="jivo-no-transition","undefined"==typeof SVGRect&&(ve.className+=" no-svg"),(ge.frameElement||ge).style.cssText="width:100%;height:100%;border:0",e.jivo_init=function(){me=0;var o=t.createEvent("Event");o.initEvent("jBeforeunload",!0,!0),e.dispatchEvent(o),c()},e.atob&&"complete"!==t.readyState?z(e,"load",c):c(),z(e,"message",function(o){if(!o||!o.data||"object"!=typeof o.data)return void(re&&1===re.logs&&oe&&oe.log&&oe.log("Error receive postMessage, window message event is empty."));var r,n,i=o.data;if("in_node_webkit"==i.name&&(r||(r=o.source,n=o.origin),r&&n)){e.jivo_cobrowse={source:r,origin:n};var a="jv_"+encodeURIComponent("langpack")+"_"+re.widget_id+"="+encodeURIComponent(JSON.stringify(i.langpack));re.cookie_domain&&(a+="; domain="+re.cookie_domain),a+="; path=/",t.cookie=a,r.postMessage({name:"widget_ready"},n)}"iframe_url_changed"!=i.name&&"iframe_url_changed"!=i||p()},!1)}function c(){var e=U();return Q("startLoadBundle",e),re.build_number!==Ne.buildNumber&&e!==re.base_url?void f(e):void(D()||e===re.base_url?g(e):f(e))}function f(e){var t=new XMLHttpRequest,o=U(!0)+"/ping?rand="+(new Date).getTime();Q("Pinging host",o),t.onreadystatechange=function(){if(4===t.readyState)if(204===t.status){clearTimeout(le),Q("Host is available",e);var o={type:Ne.availableHostInfo.type,retriesCount:_e,host:e};w("availableHostInfo",o),w("buildNumber",re.build_number),g(e)}else 0!==t.status&&(Q("Ping host error",e),q("error",e,t.status))},t.open("GET",o,!0),t.send(null),X()}function g(e){Q("Insertion of bundle code from",e);var o=t.getElementsByTagName("head")[0],r=t.createElement("script"),n=J(e);ue=ue||(new Date).getTime(),M(r),r.className="js-jivo-bundle",r.src=n,ce.bundleSrc=n,r.onerror=function(){q("error",e)},o.appendChild(r)}function v(e){clearTimeout(le),se=e;var t=((new Date).getTime()-ue)/1e3;t>6&&w("loadTime",t),w("bundleLoaded",!0),w("buildNumber",re.build_number),Q("Bundle is loaded"),m()}function m(){ae=t.body.lastChild,ve.style&&(ve.style.opacity="0",ve.style.visibility="hidden"),ve.setAttribute("id","jivo-iframe-container"),ve.appendChild(ge),ae?ae.parentNode.insertBefore(ve,ae.nextSibling):t.body.appendChild(ve),p()}function p(){if(!(me++>3)){if(!se)return me--,c();try{ie=ge.contentWindow.document}catch(e){ne=t.domain,ge.src="javascript:var d=document.open();d.domain='"+ne+"';void(0);",ie=ge.contentWindow.document}var e="<!doctype HTML>",o='<meta name="google" content="notranslate"><meta http-equiv="X-UA-Compatible" content="IE=edge" />',r="<script type=\"text/javascript\">window.onerror = function (message, url, lineNumber, columnNumber, error) {    if (error && error.error) {        error = error.error;    }    if (!error || !(error instanceof Error)) {        error = {};    }    if (error.stack) {        error.stack = error.message + ' ' + error.stack;    }    error.message = 'Bundle init error';    error.columnNumber = columnNumber;    error.lineNumber = lineNumber;    error.url = url;    window.parent.__jivoOnError(error);};"+se+"</script>",n="<head>"+o+r+"</head>",i='<body class="notranslate"><div id="widget"></div><div id="player"></div></body>';ie.write(e+n+i),ie.close()}}function b(){var e={isChatStarted:null,geoWidgetInfo:{widgetId:null,clientLocation:null,region:null},configHost:null,deletedInfo:{widgetId:null,resolveTime:null},availableHostInfo:{retriesCount:null,type:null,host:null},buildNumber:null,bundleLoaded:null,isNewCode:null,loadTime:null,log:null};if(ce.hasStorage){var t=JSON.parse(localStorage.getItem("jv_loader_info"));t&&h(t,e)}return e}function w(e,t){if(Ne[e]=t,ce.hasStorage){var o={};h(Ne,o),localStorage.setItem("jv_loader_info",JSON.stringify(o))}}function h(e,t){var o=Object.keys(e);o.forEach(function(o){_(e[o])||(t[o]=e[o])})}function _(e){if(y(e))return!0;if("object"==typeof e){for(var t=Object.keys(e),o=0;o<t.length;o++)if(!y(e[t[o]]))return!1;return!0}}function y(e){return null===e&&"object"==typeof e}function j(){if(t.currentScript&&t.currentScript.src)return t.currentScript.src;try{throw new Error("Get script URL")}catch(t){var e=t.stack;if(e){var o=I(e),r=N(e),n=E(e);return o?o[0]:r?r[0]:n?n[0]:null}}}function S(){return Ee+"/script/widget/config/"+Te}function C(){Ee=Ne.configHost,Te=Ne.geoWidgetInfo.widgetId;var e=j(),o=I(e),r=N(e),n=E(e);if(Ee||(o?(Ee="//"+o[1],w("isNewCode",!0)):r?Ee="//"+r[1]:n&&(Ee="//"+n[1])),!Te)if(r&&r[2])Te=r[2],w("isNewCode",!1);else if(n&&n[2])Te=n[2],w("isNewCode",!1);else if(w("isNewCode",!0),t.currentScript)Te=t.currentScript.getAttribute("jv-id");else{var i=t.querySelector("script[jv-id]");i&&(Te=i.getAttribute("jv-id"))}}function I(e){return e&&e.match(/https?:\/\/(\S+)\/widget\.js/)}function N(e){return e&&e.match(/https?:\/\/(\S+)\/script\/widget\/([A-Za-z0-9]+)/)}function E(e){return e&&e.match(/https?:\/\/(\S+)\/script\/geo-widget\/([A-Za-z0-9]+)/)}function T(){return!!(Ne.deletedInfo.widgetId&&Ne.deletedInfo.widgetId===Te&&Ne.deletedInfo.resolveTime&&parseInt(Ne.deletedInfo.resolveTime)>=(new Date).getTime())}function L(e,t,o){return{widgetId:e,region:t,clientLocation:o}}function O(e){var t,o,r=e.regions,n=H(e.geoip);if(r){for(var i=Object.keys(r),a=0;a<i.length;a++)for(var l=r[i[a]],s=0;s<l.length;s++)if(1!=l.length||"default"!==l[s]){var d=H(l[s]);if(n.country===d.country){if(n.region===d.region)return L(i[a],l[s],e.geoip);o||d.region||(o=L(i[a],l[s],e.geoip))}}else t=i[a];if(o)return o;if(t)return L(t,"default",e.geoip)}}function H(e){if("string"==typeof e&&""!==e){var t=e.split(";");return{country:t[0],region:t[1],city:t[2]}}}function k(){Q("Widget was removed",Te),w("configHost",null),Ne.geoWidgetInfo.widgetId||Ne.isChatStarted?(w("geoWidgetInfo",L(null,null,null)),w("isChatStarted",null),A()):(w("deletedInfo",{widgetId:Te,resolveTime:((new Date).getTime()+he).toString()}),oe.error("This widget is permanently removed"))}function B(){if(Q("Config loading error"),ye>we){Q("Config load retries count is exceeded");var t=new Error("Config not loaded. Response status code "+xhr.status);e.__jivoOnError(t)}else ye++,w("geoWidgetInfo",L(null,null,null)),w("isChatStarted",null),w("configHost",null),A()}function A(){Te=null,Ee=null,C()}function M(e){return e.type="text/javascript",e.async=!0,e.charset="UTF-8",e}function R(e){var t;return t=e.responseType&&"text"!==e.responseType?"document"===e.responseType?e.responseXML:e.response:e.responseText}function x(){return void 0!==re.host_blacklist&&re.host_blacklist.indexOf(e.location.host)>=0}function W(){if("string"==typeof re.geoip&&""!==re.geoip){var e=re.geoip.split(";")[0];null!==P(e)&&(Ie=e)}if(!D()){var t={type:null,retriesCount:null,host:null};w("availableHostInfo",t),w("buildNumber",null)}var o=re.static_host?re.static_host.split("/"):[];Ce=o[1]?"/"+o[1]:"";var r=Ne.availableHostInfo;_e=r.retriesCount?r.retriesCount:_e,_e>4&&(_e=4),de=P(Ie)}function P(e){var t=Object.keys(Se),o=null;return t.forEach(function(t){if(!o){var r=Se[t];r.indexOf(e)!==-1&&(o=t)}}),o}function D(){var e=Ne.availableHostInfo;return Ne.buildNumber===re.build_number&&e.host}function U(e){var t,o=e?"":Ce;return re.static_host?(D()?t=Ne.availableHostInfo.host:0===_e?(de=P(Ie),t=je[de]+o):1===_e?(de=V(Se,de),t=je[de]+o):t=re.base_url,t):re.base_url}function V(e,t){var o=Object.keys(e),r=G(o);return r===t?V(e,t):r}function G(e){return e[Math.floor(Math.random()*e.length)]}function J(e){var t=re.bundle_folder?re.bundle_folder:"";return e+t+"/js/bundle_"+re.locale+".js?rand="+re.build_number}function q(t,o,r){if(clearTimeout(le),++_e>=be){Q("Bundle load retries count is exceeded");var n="Bundle not loaded. Type: "+t,i=o?". Host: "+o:"",a=r?". Status code: "+r:"",l=new Error(n+i+a);return void e.__jivoOnError(l)}var s={type:t,retriesCount:_e,host:null};Ne.availableHostInfo=s,c()}function X(){le=setTimeout(function(){q("timeout")},pe)}function z(t,o,r){t.addEventListener?t.addEventListener(o,r,!1):t.attachEvent&&(t.attachEvent("on"+o,function(t){return function(){r.call(t,e.event)}}(t)),t=null)}function F(){re.cp_tracker_id&&re.cp_tracker_url&&(e._cp={trackerId:re.cp_tracker_id},Z(re.cp_tracker_url))}function Z(e,o){var r=o||t,n=r.getElementsByTagName("script"),i=n[0],a=r.createElement("script");M(a),i.parentNode.insertBefore(a,i).src=e}function K(e){e.loaderContext=ce,e.globalStore=ce,Y()}function Y(){se=null;for(var e=t.getElementsByTagName("head")[0],o=e.getElementsByClassName("js-jivo-bundle"),r=0;r<o.length;r++)o[r].parentNode&&(o[r].parentNode.removeChild(o[r]),o[r]=null);o=null}function Q(){if(Ne.log){var e=Array.prototype.slice.call(arguments||[]);e.unshift("Loader:"),oe.log.apply(oe,e)}}function $(){return!!e.WebSocket}function ee(e){i(e)}function te(){k()}var oe=e.console;if(oe||(oe={log:function(){},error:function(){}}),!$())return void oe.log("Not supported browser");if("undefined"==typeof e.jivo_magic_var){e.jivo_magic_var=!0;var re,ne,ie,ae,le,se,de,ue,ce={hasStorage:e.__hasStorage,jivoLoaderVersion:o,loadScript:Z,currentLoaderVersionCache:r},fe=/iPhone|iPad|iPod|Android|Windows Phone/i.test(navigator.userAgent),ge=t.createElement("iframe"),ve=t.createElement("div"),me=0,pe=5e3,be=5,we=3,he=6048e5,_e=0,ye=0,je=[["//cdn-fr.jivosite.com"],["//cdn-cis.jivosite.com"],["//cdn-ca.jivosite.com"]],Se={0:["default"],1:["RU","KZ","UA","BY"],2:["US","CA","AG","BS","BB","BZ","HT","GT","HN","GD","DM","DO","MX","NI","PA","SV","LC","VC","KN","TT","JM","CR","CU","AR","BR","BO","VE","GY","CO","PY","PE","SR","UY","CL","EC","AU","VU","KI","MH","FM","NR","NZ","PW","PG","WS","SB","TK","TV","FJ","PH"]},Ce="",Ie="default",Ne=b();Q("Initialization"),e.__jivoBundleOnLoad=v,e.__jivoBundleInit=K,ce.getHostURL=U,ce.loadConfig=n,ce.store=Ne,ce.setInStore=w;var Ee,Te;C(),Te&&Ee?(Q("widgetId:",Te,"configHost:",Ee),n(S())):Te&&Ee||oe.error("Failed to evaluate the widgetId or configHost"),e.__jivoConfigOnLoad=ee,e.__jivoCacheDeletedWidget=te}}var t=.1;window.__hasStorage=!1;try{localStorage.setItem("testLocalStorage","ok"),localStorage.removeItem("testLocalStorage"),window.__hasStorage=!0}catch(e){}var o=e,r=null;if(window.__hasStorage){try{r=JSON.parse(localStorage.getItem("__jivoLoader"))}catch(e){e.message="Loader parse error",window.__jivoOnError(e)}r&&r.version>t&&(o=new Function("window","document","broswerCacheLoaderVersion","currentLoaderVersionCache","("+r.code+")(window, document, broswerCacheLoaderVersion, currentLoaderVersionCache)"))}try{o(window,document,t,r?r.version:t)}catch(r){r.message=r.message?"Loader error. "+r.message:"Loader error",window.__jivoOnError(r),delete window.jivo_magic_var,o=e,o(window,document,t,t)}}();